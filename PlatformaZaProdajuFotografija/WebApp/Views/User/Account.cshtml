@model WebApp.ViewModels.UserVM
@{
    ViewData["Title"] = "Your Account";
    bool isEditing = false;
    //TODO add change password
}
<div>
    <h1>Your Account</h1>
    <button id="editButton" class="btn btn-secondary" onclick="toggleEdit()">Edit</button>
    <form id="accountForm" asp-action="EditUser" asp-controller="User" style="display: none;">
        <div class="form-group">
            <label asp-for="Username" class="control-label"></label>
            <input asp-for="Username" class="form-control" id="usernameInput"/>
        </div>
        <button class="btn btn-success" type="submit">Save</button>
    </form>

    <form id="passwordForm" asp-action="ChangePassword" asp-controller="User" style="display: none;">
        <div class="form-group">
            <label class="control-label" for="oldPassword">Old Password</label>
            <input class="form-control" name="oldPassword" id="oldPassword"/>

        </div>
        <div class="form-group">
            <label class="control-label" for="newPassword">New Password</label>
            <input class="form-control" name="newPassword" id="newPassword"/>
        </div>
        <button class="btn btn-success" type="submit">Save</button>
    </form>
    <div id="accountDetails">
        <h2 id="usernameDisplay">@Model.Username</h2>
    </div>
    @foreach (var download in Model.Downloads)
    {
        <p>@download</p>
    }
</div>

<script>
    function toggleEdit() {
        const forms = document.querySelectorAll('form');
        const details = document.getElementById('accountDetails');
        forms.forEach(form => {
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        });
        details.style.display = details.style.display === 'none' ? 'block' : 'none';
    }
    const passwordForm = document.getElementById('passwordForm');
    passwordForm.addEventListener('click', (e) => {
        e.preventDefault();
        const oldPassword = document.getElementById('oldPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        fetch('/User/ChangePassword', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                oldPassword,
                newPassword
            })
        })
        .then(res => res.json())
        .then(data => {
            console.log(data);
        });
    });
</script>